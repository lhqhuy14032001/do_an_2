<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý người dùng</title>
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<style>
    label.error {
        padding: 5px 0;
        min-width: 100%;
        color: red;
        display: block;
    }
</style>

<body>
<section id="header">
    <%- include('../header.ejs') %>
</section>
<div class="container my-3 ">
    <button type="button" class="btn-create-user btn btn-outline-success btn-lg float-right"
            data-bs-toggle="modal" data-bs-target="#exampleModal">
        Thêm nhân viên
    </button>
    <!-- Modal add new user -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="exampleModalLabel">Thêm người dùng</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="notification alert alert-danger" role="alert"></div>
                    <form id="create-user" method="post">
                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isAdmin" name="isAdmin">
                                <label class="form-check-label" for="isAdmin">
                                    QUYỀN QUẢN TRỊ
                                </label>
                            </div>
                            <div class="mb-3">
                                <label>Email</label>
                                <input type="email" name="email" id="email" class="form-control"
                                       placeholder="Email">
                            </div>

                            <div class="mb-3">
                                <label>Mật khẩu</label>
                                <input type="password" name="password" id="password" class="form-control"
                                       placeholder="Mật khẩu">
                            </div>

                            <div class="mb-3">
                                <label>Họ</label>
                                <input type="text" name="lastname" id="lastname" class="form-control"
                                       placeholder="Họ">
                            </div>

                            <div class="mb-3">
                                <label>Tên</label>
                                <input type="text" name="firstname" id="firstname" class="form-control"
                                       placeholder="Tên">
                            </div>

                            <div class="mb-3">
                                <label>Số điện thoại</label>
                                <input type="text" name="phonenumber" id="phonenumber" class="form-control"
                                       placeholder="Số điện thoại">
                            </div>

                            <div class="mb-3">
                                <label>Địa chỉ</label>
                                <input type="text" name="address" id="address" class="form-control"
                                       placeholder="Địa chỉ">
                            </div>

                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="add-user" type="button" class="btn btn-success">Thêm người dùng</button>
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal add new user -->

    <!--  state delete -->

    <!--  state delete -->


    <section class="user-list mt-3">
        <h1>Danh sách nhân viên</h1>
        <table id="users-list" class=" table table-striped">
            <thead>
            <tr>
                <th>Email</th>
                <th>Họ</th>
                <th>Tên</th>
                <th>Vai trò</th>
                <th>Số điện thoại</th>
                <th>Địa chỉ</th>
                <th>Chức năng</th>
            </tr>
            </thead>
            <tbody class="users-list">
            <% if (users.length > 0) { %>
                <% users.forEach((user, index)=> { %>
                    <tr>
                        <td>
                            <%= user.email %>
                        </td>
                        <td>
                            <%= user.lastname %>
                        </td>
                        <td>
                            <%= user.firstname %>
                        </td>
                        <td>
                            <%= user.isAdmin == 0 ? 'Nhân viên' : 'Quản trị viên' %>
                        </td>
                        <td>
                            <%= user.phonenumber %>
                        </td>
                        <td>
                            <%= user.address %>
                        </td>
                        <td>
                            <a href="/admin/edit?id=<%= user.id %>" class="btn-edit btn btn-warning">Sửa</a>
                            <a onclick="handleDeleteUser(<%= user.id %>)" class="btn-delete btn btn-danger">Xoá</a>
                        </td>
                    </tr>
                <% }); %>
            <% } %>
            </tbody>
        </table>
    </section>
    <div class="col-12">
        <div class="row">
            <button class="<%= isShowViewmore ? 'd-none ' : 'd-block ' %> btn-viewmore btn btn-success offset-4 col-3">
                Xem thêm
            </button>
        </div>
    </div>
</div>
<%- include('../footer.ejs') -%>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script src="/js/admin/users_manage.js"></script>
<script>
    <!--    href="/admin/delete?id= user.id "-->
    let btnDelete = $('.btn-delete')
    let handleDeleteUser = (id) => {
        let currentLoginUser = localStorage.getItem('userLoginID');
        let data = {
            id: id,
            currentLoginUser: currentLoginUser
        }
        $.ajax({
            url: '/admin/delete',
            data: data,
            success: (data) => {
                if (data.err == 1) {
                    alert(data.msg)
                } else {
                    location.reload()
                }
            }
        })
    }
</script>

</body>

</html>